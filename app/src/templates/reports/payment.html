{% load static %}
<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <link rel="icon" href="/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="{% static 'css/invoice_style.css' %}" rel="stylesheet" type="text/css" />
    <title>Comprobante de Pago {{ payment.payment_number|default:payment.id }}</title>
    <link href="{% static 'css/payment_receipt.css' %}" rel="stylesheet" type="text/css" />
    <style>
      /* Estilos específicos para el comprobante de pago */
      .payment-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 20px;
      }
      .payment-logo {
        max-width: 200px;
      }
      .payment-title {
        text-align: right;
        color: #fb923c;
        font-weight: bold;
      }
      .payment-info {
        margin: 20px 0;
      }
      .info-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin-bottom: 15px;
      }
      .info-label {
        font-weight: bold;
        color: #6b7280;
      }
      .section-title {
        color: #fb923c;
        font-size: 1.1em;
        margin: 15px 0 10px 0;
        border-bottom: 1px solid #fb923c;
        padding-bottom: 5px;
      }
      .invoices-table {
        width: 100%;
        border-collapse: collapse;
        margin: 15px 0;
      }
      .invoices-table th {
        background-color: #fb923c;
        color: white;
        text-align: left;
        padding: 8px;
      }
      .invoices-table td {
        padding: 8px;
        border-bottom: 1px solid #e5e7eb;
      }
      .invoices-table tr:nth-child(even) {
        background-color: #f9fafb;
      }
      .total-amount {
        text-align: right;
        font-size: 1.2em;
        font-weight: bold;
        margin-top: 15px;
        color: #10b981;
      }
      .footer {
        margin-top: 30px;
        font-size: 0.8em;
        text-align: center;
        color: #6b7280;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Encabezado con logo y número de comprobante -->
      <div class="payment-header">
        <img src="https://kosmoflowers.com/wp-content/uploads/2022/07/Mesa-de-trabajo-6.svg" 
             alt="Logo Kosmo Flowers" class="payment-logo"/>
        <div class="payment-title">
          <h2>COMPROBANTE DE PAGO</h2>
          <p>No. {{ payment.payment_number|default:payment.id }}</p>
          <p>Fecha: {{ payment.date|date:'Y-m-d' }}</p>
        </div>
      </div>

      <!-- Información de la empresa -->
      <div class="company-info">
        <div class="company-info-left">
          <div><strong>Roses Grown by:</strong> KOSMO FLOWERS</div>
          <div><strong>Address:</strong> Tupigachi - Tabacundo</div>
          <div><strong>Country:</strong> ECUADOR</div>
        </div>
        <div class="company-info-right">
          <p><strong>Email:</strong> invoices@kosmoflowers.com</p>
          <p><strong>Phone:</strong> (+593) 0999475741</p>
        </div>
      </div>

      <!-- Información del pago -->
      <div class="payment-info">
        <h2 class="section-title">Información del Pago</h2>
        <div class="payment-info-container">
          <!-- Detalles del pago a la izquierda -->
          <div class="payment-details">
            <div class="info-grid">
              <div class="info-label">Método de Pago:</div>
              <div>{{ payment.get_method_display }}</div>
              
              <div class="info-label">Estado:</div>
              <div>{{ payment.get_status_display }}</div>
              
              <div class="info-label">Tipo de Transacción:</div>
              <div>{{ payment.get_type_transaction_display }}</div>
              
              {% if payment.bank %}
              <div class="info-label">Banco:</div>
              <div>{{ payment.bank }}</div>
              {% endif %}
              
              {% if payment.nro_operation %}
              <div class="info-label">Número de Operación:</div>
              <div>{{ payment.nro_operation }}</div>
              {% endif %}
              
              {% if payment.nro_account %}
              <div class="info-label">Número de Cuenta:</div>
              <div>{{ payment.nro_account }}</div>
              {% endif %}
              
              <div class="info-label">Monto Total:</div>
              <div style="font-weight: bold; color: #10b981;">${{ payment.amount|floatformat:2 }}</div>
            </div>
          </div>
          
          <!-- Sección de imagen del pago a la derecha -->
          <div class="payment-image-container">
            {% if payment.document %}
              <img src="{{ payment.document.url }}" alt="Comprobante de pago" class="payment-image" />
            {% else %}
              <div class="payment-image-placeholder">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
                <p class="mt-2">No hay imagen de comprobante</p>
              </div>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Facturas relacionadas -->
      {% if payment_details %}
      <div class="invoices-section">
        <h2 class="section-title">Facturas Pagadas ({{ total_invoices }})</h2>
        <table class="invoices-table">
          <thead>
            <tr>
              <th>Proveedor</th>
              <th>Factura</th>
              <th>Fecha</th>
              <th>Monto</th>
            </tr>
          </thead>
          <tbody>
            {% for detail in payment_details %}
            <tr>
              <td>{{ detail.invoice.partner.name|truncatechars:30 }}</td>
              <td>{{ detail.invoice.num_invoice }}</td>
              <td>{{ detail.invoice.date|date:'Y-m-d' }}</td>
              <td>${{ detail.amount|floatformat:2 }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        <div class="total-amount">
          Total Pagado: ${{ payment.amount|floatformat:2 }}
        </div>
      </div>
      {% endif %}

      <!-- Información adicional -->
      <div class="additional-info">
        <h2 class="section-title">Información Adicional</h2>
        <div class="info-grid">
          <div class="info-label">Creado por:</div>
          <div>{{ user_created.get_full_name|default:user_created.username }} ({{ user_created.email }})</div>
          
          <div class="info-label">Fecha de generación:</div>
          <div>{{ now|date:'Y-m-d H:i:s' }}</div>
          
          {% if payment.notes %}
          <div class="info-label">Notas:</div>
          <div>{{ payment.notes|linebreaksbr }}</div>
          {% endif %}
        </div>
      </div>

      <!-- Pie de página -->
      <div class="footer">
        <p>Este es un documento generado electrónicamente por el sistema de KOSMO FLOWERS</p>
        <p>© {% now "Y" %} KOSMO FLOWERS - Todos los derechos reservados</p>
      </div>
    </div>
  </body>
</html>