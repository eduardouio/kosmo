{% load static %}
<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <link rel="icon" href="/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="{% static 'css/invoice_style.css' %}" rel="stylesheet" type="text/css" />
    <title>Estado de Cuenta{% if partner %} - {{ partner.name }}{% endif %}</title>
    <style>
      /* Estilos específicos para el estado de cuenta */
      .account-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 20px;
      }
      .account-logo {
        max-width: 200px;
      }
      .account-title {
        text-align: right;
        color: #fb923c;
        font-weight: bold;
      }
      .company-info {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 20px;
        padding: 15px;
        background-color: #f9fafb;
        border-radius: 8px;
        border: 1px solid #e5e7eb;
      }
      .company-info-left,
      .company-info-right {
        font-size: 14px;
      }
      .company-info-right {
        text-align: right;
      }
      .section-title {
        color: #fb923c;
        font-size: 1.1em;
        margin: 15px 0 10px 0;
        border-bottom: 1px solid #fb923c;
        padding-bottom: 5px;
      }
      .partner-info-container {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
        padding: 20px;
        border: 2px solid #fb923c;
        border-radius: 16px;
      }
      .partner-details {
        font-size: 14px;
      }
      .account-summary {
        background-color: #f9fafb;
        border: 1px solid #fb923c;
        border-radius: 8px;
        overflow: hidden;
      }
      .account-summary-header {
        background-color: #fb923c;
        color: white;
        text-align: center;
        padding: 8px;
        font-weight: bold;
      }
      .account-summary-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        border-bottom: 1px solid #e5e7eb;
      }
      .account-summary-row:last-child {
        border-bottom: none;
      }
      .account-summary-label {
        padding: 8px;
        font-weight: bold;
        background-color: #f3f4f6;
      }
      .account-summary-value {
        padding: 8px;
        text-align: center;
      }
      .transactions-table {
        width: 100%;
        border-collapse: collapse;
        margin: 15px 0;
      }
      .transactions-table th {
        background-color: #fb923c;
        color: white;
        text-align: center;
        padding: 8px;
        font-size: 14px;
      }
      .transactions-table td {
        padding: 6px 8px;
        border-bottom: 1px solid #e5e7eb;
        font-size: 14px;
      }
      .transactions-table tr:nth-child(even) {
        background-color: #f9fafb;
      }
      .transactions-table tr.payment-row {
        background-color: #fef2f2;
        color: #dc2626;
      }
      .transactions-table tr.overdue {
        color: #dc2626;
        font-weight: bold;
      }
      .transactions-table tfoot tr {
        background-color: #f3f4f6;
        font-weight: bold;
      }
      .text-end {
        text-align: right;
      }
      .text-center {
        text-align: center;
      }
      .text-danger {
        color: #dc2626;
      }
      .text-success {
        color: #10b981;
      }
      .text-muted {
        color: #6b7280;
      }
      .alert {
        padding: 12px 20px;
        margin-bottom: 20px;
        border-radius: 4px;
      }
      .alert-info {
        background-color: #dbeafe;
        color: #1e40af;
        border: 1px solid #93c5fd;
      }
      .alert-danger {
        background-color: #fee2e2;
        color: #dc2626;
        border: 1px solid #fca5a5;
      }
      .footer {
        margin-top: 30px;
        font-size: 0.8em;
        text-align: center;
        color: #6b7280;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Encabezado con logo y título -->
      <div class="account-header">
        <img src="https://kosmoflowers.com/wp-content/uploads/2022/07/Mesa-de-trabajo-6.svg" 
             alt="Logo Kosmo Flowers" class="account-logo"/>
        <div class="account-title">
          <h2>ESTADO DE CUENTA</h2>
          <p>Período: {{ start_date|date:'d/m/Y' }} - {{ end_date|date:'d/m/Y' }}</p>
        </div>
      </div>

      <!-- Información de la empresa -->
      <div class="company-info">
        <div class="company-info-left">
          <div><strong>Roses Grown by:</strong> KOSMO FLOWERS</div>
          <div><strong>Address:</strong> Tupigachi - Tabacundo</div>
          <div><strong>Country:</strong> ECUADOR</div>
        </div>
        <div class="company-info-right">
          <p><strong>Email:</strong> invoices@kosmoflowers.com</p>
          <p><strong>Phone:</strong> (+593) 0999475741</p>
        </div>
      </div>

      <!-- Mensajes de estado -->
      {% if not partner %}
        <div class="alert alert-info">No se ha especificado un cliente o proveedor para este reporte.</div>
      {% else %}

      <!-- Información del partner -->
      <div class="partner-info-container">
        <div class="partner-details">
          <h2 class="section-title">Información del {{ partner.type_partner }}</h2>
          <div><strong>{{ partner.name|upper }}</strong></div>
          <div>City/Country: {{ partner.city|upper }} / {{ partner.country|upper }}</div>
          <div>E-mail: {{ partner.email }}</div>
          <div>Tax ID: {{ partner.business_tax_id }}</div>
          <div>Crédito: {{ partner.credit_term }} días</div>
        </div>
        
        <div class="account-summary">
          <div class="account-summary-header">RESUMEN DE CUENTA</div>
          <div class="account-summary-row">
            <div class="account-summary-label">FECHA</div>
            <div class="account-summary-value">{{ today|date:'d/m/Y' }}</div>
          </div>
          <div class="account-summary-row">
            <div class="account-summary-label">SALDO</div>
            <div class="account-summary-value {% if net_balance < 0 %}text-danger{% else %}text-success{% endif %}">
              {% if net_balance < 0 %}-${{ net_balance|floatformat:2|slice:'1:' }}{% else %}${{ net_balance|floatformat:2 }}{% endif %}
            </div>
          </div>
        </div>
      </div>
      <!-- Tabla de transacciones -->
      <div class="transactions-section">
        <h2 class="section-title">Detalle de Movimientos</h2>
        <table class="transactions-table">
          <thead>
            <tr>
              <th>FECHA</th>
              <th>DOCUMENTO</th>
              <th>TIEMPO DE CREDITO</th>
              <th>VALOR</th>
              <th>PAGO RECIBIDO</th>
              <th>SALDO ACTUAL</th>
              <th>REFERENCIA</th>
            </tr>
          </thead>
          <tbody>
            {% for e in entries %}
              {% if e.type == 'INVOICE' %}
              <tr class="{% if e.reference == 'FACTURA VENCIDA' %}overdue{% endif %}">
                <td>{{ e.date|date:'d/m/Y' }}</td>
                <td>{{ e.document }}</td>
                <td class="text-center">{{ e.credit_days }}</td>
                <td class="text-end">${{ e.invoice_amount|floatformat:2 }}</td>
                <td class="text-end">{% if e.payment_amount %}${{ e.payment_amount|floatformat:2 }}{% endif %}</td>
                <td class="text-end">${{ e.balance|floatformat:2 }}</td>
                <td class="text-center">
                  {% if e.reference == 'FACTURA VENCIDA' %}<span class="text-danger">FACTURA VENCIDA</span>
                  {% else %}{{ e.reference }}{% endif %}
                </td>
              </tr>
              {% else %}
              <tr class="payment-row">
                <td>{{ e.date|date:'d/m/Y' }}</td>
                <td>{{ e.document }}</td>
                <td></td>
                <td></td>
                <td class="text-end">${{ e.payment_amount|floatformat:2 }}</td>
                <td></td>
                <td class="text-center">PAGO RECIBIDO</td>
              </tr>
              {% endif %}
            {% empty %}
            <tr><td colspan="7" class="text-center text-muted">Sin movimientos en el período seleccionado</td></tr>
            {% endfor %}
          </tbody>
          <tfoot>
            <tr>
              <td colspan="3" class="text-end">TOTAL PENDIENTE</td>
              <td class="text-end">${{ total_invoices_amount|floatformat:2 }}</td>
              <td class="text-end">${{ total_payments_amount|floatformat:2 }}</td>
              <td class="text-end">${{ total_pending_balance|floatformat:2 }}</td>
              <td></td>
            </tr>
          </tfoot>
        </table>
      </div>
      
      <!-- Información bancaria para clientes -->
      {% if partner.type_partner == 'CLIENTE' %}
      <div class="bank-info" style="font-size: 10px; margin-top: 30px; padding: 15px; background-color: #f9fafb; border-radius: 8px; border: 1px solid #e5e7eb;">
        <strong class="text-muted">Payment Info</strong>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 10px;">
          <div style="line-height: 1.2;">
            <p style="margin: 0 0 3px 0;"><strong>ECUADOR BANK ACCOUNT</strong></p>
            <p style="margin: 0 0 2px 0;"><strong>Beneficiary:</strong> Kosmo Flowers SAS</p>
            <p style="margin: 0 0 2px 0;"><strong>Beneficiary Address:</strong> Pasaje Cusua y Pasaje Timasa</p>
            <p style="margin: 0 0 2px 0;"><strong>RUC:</strong> 1793205904001</p>
            <p style="margin: 0 0 2px 0;"><strong>Bank:</strong> Banco del Pacífico</p>
            <p style="margin: 0 0 2px 0;"><strong>Bank Address:</strong> P. Icaza y Pedro Carbo</p>
            <p style="margin: 0 0 2px 0;"><strong>Account Number:</strong> 1067343082</p>
            <p style="margin: 0 0 2px 0;"><strong>Account Type:</strong> Savings</p>
            <p style="margin: 0 0 2px 0;"><strong>Swift Code:</strong> PACIECEG</p>
          </div>
          
          <div style="line-height: 1.2;">
            <p style="margin: 0 0 3px 0;"><strong>UNITED STATES BANK ACCOUNT</strong></p>
            <p style="margin: 0 0 2px 0;"><strong>Beneficiary:</strong> KOSMOFLOWERS LLC</p>
            <p style="margin: 0 0 2px 0;"><strong>Address:</strong> 7050 W PALMETTO PARK RD STE 15 300, BOCA RATON, FL 33433</p>
            <p style="margin: 0 0 2px 0;"><strong>Account Number:</strong> 532732693</p>
            <p style="margin: 0 0 2px 0;"><strong>Bank:</strong> JPMORGAN CHASE</p>
            <p style="margin: 0 0 2px 0;"><strong>Bank Address:</strong> 270 PARK AVENUE NEW YORK NY 10017</p>
            <p style="margin: 0 0 2px 0;"><strong>ABA for ACH:</strong> 267084131</p>
            <p style="margin: 0 0 2px 0;"><strong>ABA for WIRES:</strong> 021000021</p>
          </div>
        </div>
      </div>
      {% endif %}
      {% endif %}

      <!-- Pie de página -->
      <div class="footer">
        <p>Este es un documento generado electrónicamente por el sistema de KOSMO FLOWERS</p>
        <p>© {% now "Y" %} KOSMO FLOWERS - Todos los derechos reservados</p>
      </div>
    </div>


  </body>
</html>
