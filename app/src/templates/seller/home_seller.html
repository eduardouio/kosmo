{% extends 'seller/base_seller.html' %}
{% block content %}
<section class="space-y-4">
	<header class="flex flex-col gap-1">
		<h1 class="text-base font-semibold leading-tight">Hola, {{ seller_name }}</h1>
		<p class="text-xs opacity-70">Resumen general de tu desempeño</p>
	</header>

	<!-- KPIs -->
	<div class="grid grid-cols-2 gap-2 sm:gap-3 md:grid-cols-4">
		<div class="card bg-base-100 shadow-sm border border-base-200">
			<div class="card-body p-3">
				<h6 class="text-[10px] font-semibold tracking-wide uppercase opacity-60">Ventas Totales</h6>
				<p class="text-lg font-bold">${{ total_sales|floatformat:2 }}</p>
				<span class="text-[10px] opacity-60">Monto acumulado</span>
			</div>
		</div>
		<div class="card bg-base-100 shadow-sm border border-base-200">
			<div class="card-body p-3">
				<h6 class="text-[10px] font-semibold tracking-wide uppercase opacity-60">Tallos Vendidos</h6>
				<p class="text-lg font-bold">{{ stems_sold }}</p>
				<span class="text-[10px] opacity-60">Total facturado</span>
			</div>
		</div>
		<div class="card bg-base-100 shadow-sm border border-base-200">
			<div class="card-body p-3">
				<h6 class="text-[10px] font-semibold tracking-wide uppercase opacity-60">Tallos Pendientes</h6>
				<p class="text-lg font-bold text-warning">{{ stems_pending }}</p>
				<span class="text-[10px] opacity-60">Órdenes sin factura</span>
			</div>
		</div>
		<div class="card bg-base-100 shadow-sm border border-base-200">
			<div class="card-body p-3">
				<h6 class="text-[10px] font-semibold tracking-wide uppercase opacity-60">Compras Pendientes</h6>
				<p class="text-lg font-bold text-error">${{ pending_buys|floatformat:2 }}</p>
				<span class="text-[10px] opacity-60">Compra activa</span>
			</div>
		</div>
	</div>

	<!-- Bloques -->
	<div class="grid gap-3 md:grid-cols-3">
		<!-- Ventas por estado -->
		<div class="card bg-base-100 border border-base-200 shadow-sm">
			<div class="card-body p-3">
				<h2 class="text-[10px] font-bold tracking-wide uppercase opacity-70 mb-2">Ventas por Estado</h2>
				<div class="overflow-x-auto">
					<table class="table table-xs">
						<thead>
							<tr class="text-[10px] opacity-60"><th>Estado</th><th class="text-right">#</th><th class="text-right">Total</th></tr>
						</thead>
						<tbody>
							{% for status, info in sales_by_status.items %}
							<tr class="text-[11px]">
								<td>
									<span class="badge badge-sm border-0 text-[10px] {% if status == 'PAGADO' %}badge-success{% elif status == 'PENDIENTE' %}badge-error{% else %}badge-ghost{% endif %}">{{ status }}</span>
								</td>
								<td class="text-right">{{ info.count }}</td>
								<td class="text-right">${{ info.total|floatformat:2 }}</td>
							</tr>
							{% empty %}
							<tr><td colspan="3" class="text-center text-xs opacity-50">Sin datos</td></tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
			</div>
		</div>

		<!-- Top Clientes -->
		<div class="card bg-base-100 border border-base-200 shadow-sm">
			<div class="card-body p-3 space-y-2">
				<h2 class="text-[10px] font-bold tracking-wide uppercase opacity-70">Top Clientes</h2>
				<div class="max-h-60 overflow-auto pr-1 space-y-1">
					{% for c in top_customers %}
					<div class="flex items-center justify-between bg-base-200 rounded-lg px-2 py-1">
						<div class="flex flex-col">
							<span class="text-[11px] font-semibold">{{ c.short_name|default:c.name }}</span>
							<span class="text-[10px] opacity-60">{{ c.invoices_count }} fac</span>
						</div>
						<div class="text-right">
							<span class="block text-[11px] font-semibold">${{ c.sales_total|floatformat:2 }}</span>
							<span class="text-[10px] opacity-60">{{ c.stems_total }} tallos</span>
						</div>
					</div>
					{% empty %}
					<p class="text-[11px] opacity-60">Sin clientes</p>
					{% endfor %}
				</div>
			</div>
		</div>

		<!-- Órdenes de Venta -->
		<div class="card bg-base-100 border border-base-200 shadow-sm">
			<div class="card-body p-3">
				<h2 class="text-[10px] font-bold tracking-wide uppercase opacity-70 mb-2">Órdenes de Venta</h2>
				<div class="overflow-x-auto">
					<table class="table table-xs">
						<thead><tr class="text-[10px] opacity-60"><th>#</th><th>Fecha</th><th class="text-right">Tallos</th><th class="text-right">$</th></tr></thead>
						<tbody>
							{% for o in customer_orders %}
							<tr class="text-[11px]">
								<td>{{ o.consecutive }}</td>
								<td>{{ o.date }}</td>
								<td class="text-right">{{ o.tot_stem_flower }}</td>
								<td class="text-right">${{ o.total_price|floatformat:2 }}</td>
							</tr>
							{% empty %}
							<tr><td colspan="4" class="text-center text-xs opacity-50">Sin órdenes</td></tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
			</div>
		</div>

		<!-- Órdenes de Compra -->
		<div class="card bg-base-100 border border-base-200 shadow-sm md:col-span-2">
			<div class="card-body p-3">
				<h2 class="text-[10px] font-bold tracking-wide uppercase opacity-70 mb-2">Órdenes de Compra</h2>
				<div class="overflow-x-auto">
					<table class="table table-xs">
						<thead><tr class="text-[10px] opacity-60"><th>#</th><th>Fecha</th><th>Estado</th><th class="text-right">$</th></tr></thead>
						<tbody>
							{% for o in supplier_orders %}
							<tr class="text-[11px]">
								<td>{{ o.consecutive }}</td>
								<td>{{ o.date }}</td>
								<td><span class="badge badge-ghost badge-sm text-[10px]">{{ o.status }}</span></td>
								<td class="text-right">${{ o.total_price|floatformat:2 }}</td>
							</tr>
							{% empty %}
							<tr><td colspan="4" class="text-center text-xs opacity-50">Sin órdenes</td></tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
			</div>
		</div>

		<!-- Placeholder Gráfico -->
		<div class="card bg-base-100 border border-base-200 shadow-sm">
			<div class="card-body p-3 items-center justify-center flex min-h-[150px]">
				<div class="text-center space-y-2">
					<h3 class="text-[11px] font-semibold">Evolución Semanal</h3>
						<p class="text-[10px] opacity-60">Próximamente un gráfico interactivo.</p>
						<div class="w-40 h-1 bg-gradient-to-r from-primary to-secondary rounded opacity-40 mx-auto"></div>
				</div>
			</div>
		</div>
	</div>
</section>
{% endblock %}